const Q = require('q'),
      config = require('../config/main'),
      fs = require('fs'),
      virustotal = require('node-virustotal'),
      connnection = virustotal.MakePublicConnection();

module.exports = function checkMalware(fileName, fileType, filePath) {
    var deferred = Q.defer()

    connnection.setKey(config.total_virus_apikey)

    connnection.submitFileForAnalysis(
        fileName,
        fileType,
        fs.readFileSync(filePath), function(fileClear) {

        deferred.resolve(fileClear)
    }, function(err){
        deferred.reject(err)
    })

    return deferred.promise
};
